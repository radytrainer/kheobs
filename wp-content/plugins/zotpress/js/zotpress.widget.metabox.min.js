jQuery(document).ready((function(){jQuery("#zp-ZotpressMetaBox").length>0&&jQuery("#zp-ZotpressMetaBox").tabs({activate:function(e,t){"zp-ZotpressMetaBox-InText"==t.newPanel.attr("id")?jQuery("#zp-ZotpressMetaBox-List").addClass("intext"):jQuery("#zp-ZotpressMetaBox-List").removeClass("intext")}}),window.zpBiblio={author:!1,year:!1,style:!1,sortby:!1,sort:!1,image:!1,download:!1,notes:!1,zpabstract:!1,cite:!1,title:!1,limit:!1},window.zpInText={format:!1,etal:!1,and:!1,separator:!1,brackets:!1},window.zpInTextBib={style:!1,sortby:!1,sort:!1,image:!1,title:!1,download:!1,zpabstract:!1,notes:!1,cite:!1},window.zpRefItems=[],jQuery("input#zp-ZotpressMetaBox-Search-Input").bind("keydown",(function(e){13===e.keyCode&&e.preventDefault()})).bind("focus",(function(e){jQuery(this).autocomplete("option","source",zpWidgetMetabox.ajaxurl+"?action=zpWidgetMetabox-submit&api_user_id="+jQuery("#zp-ZotpressMetaBox-Acccount-Select").val()),jQuery("#zp-ZotpressMetaBox-Biblio-Generate-Inner").hide("fast"),jQuery("#zp-ZotpressMetaBox-InText-Generate-Inner").hide("fast")})).bind("blur",(function(e){})).autocomplete({source:zpWidgetMetabox.ajaxurl+"?action=zpWidgetMetabox-submit&api_user_id="+jQuery("#zp-ZotpressMetaBox-Acccount-Select").val(),minLength:3,focus:function(){return!1},create:function(){jQuery(this).data("ui-autocomplete")._renderItem=function(e,t){return jQuery("<li data-api_user_id='"+t.api_user_id+"'>").append("<a><strong>"+t.author+"</strong> "+t.label+"</a>").appendTo(e)}},open:function(){var e=jQuery(this).data("ui-autocomplete").menu;e.element;e.element.addClass("zp-autocomplete"),jQuery(".zp-autocomplete .ui-menu-item:first").addClass("first"),"normal-sortables"==jQuery("#ZotpressMetaBox").parent().attr("id")?e.element.addClass("zp-autocomplete-wide"):e.element.removeClass("zp-autocomplete-wide")},select:function(e,t){var i=!1;if(jQuery.each(window.zpRefItems,(function(e,o){o.itemkey==t.item.value&&(i=!0)})),!1===i){window.zpRefItems.push({api_user_id:t.item.api_user_id,itemkey:t.item.value,pages:!1});t.item.label.split(")",1);var o="<div class='item' rel='"+t.item.value+"' data-api_user_id='"+t.item.api_user_id+"'";t.item.nickname&&(o+=" data-nickname='"+t.item.nickname+"'"),o+=">",o+="<span class='label'>"+t.item.author+t.item.label+"</span>",o+="<div class='options'>",o+="<label for='zp-Item-"+t.item.value+"'>"+zpWidgetMetabox.txt_pages+":</label><input id='zp-Item-"+t.item.value+"' type='text'>",o+="</div>",o+="<div class='item_key'>&rsaquo; "+zpWidgetMetabox.txt_itemkey+": <strong>"+t.item.value+"</strong></div>",o+="<div class='account'",t.item.nickname&&(o+=" data-nickname='"+t.item.nickname+"'"),o+="data-api_user_id='"+t.item.api_user_id+"'>&rsaquo; "+zpWidgetMetabox.txt_account+": <strong>",t.item.nickname&&(o+=t.item.nickname+" - "),o+=t.item.api_user_id+"</strong></div>",o+="<div class='delete'>&times;</div>",o+="</div>\n",jQuery("#zp-ZotpressMetaBox-List-Inner").append(o),jQuery("input#zp-ZotpressMetaBox-Search-Input").val("").focus()}return!1}}),jQuery("#zp-ZotpressMetaBox-List div.item .delete").livequery("click",(function(e){var t=jQuery(this).parent();jQuery(".toggle",t).hasClass("active")&&(jQuery(this).toggleClass("active"),jQuery(".options",t).slideToggle("fast")),jQuery.each(window.zpRefItems,(function(e,i){i.itemkey==t.attr("rel")&&window.zpRefItems.splice(e,1)})),t.remove(),jQuery("#zp-ZotpressMetaBox-Biblio-Generate-Inner").hide("fast"),jQuery("#zp-ZotpressMetaBox-InText-Generate-Inner").hide("fast")})),jQuery("#zp-ZotpressMetaBox-List div.item").livequery("click",(function(e){jQuery("#zp-ZotpressMetaBox-Biblio-Generate-Inner").hide("fast")})),jQuery("#zp-ZotpressMetaBox-Biblio-Options").click((function(e){jQuery("#zp-ZotpressMetaBox-Biblio-Generate-Inner").hide("fast")})),jQuery("#zp-ZotpressMetaBox-InText-Options").click((function(e){jQuery("#zp-ZotpressMetaBox-InText-Generate-Inner").hide("fast")})),jQuery("#zp-ZotpressMetaBox-Biblio-Options h4 .toggle").click((function(e){jQuery(this).toggleClass("active"),jQuery(".toggle-button",jQuery(this)).toggleClass("dashicons-arrow-down-alt2 dashicons-arrow-up-alt2"),jQuery("#zp-ZotpressMetaBox-Biblio-Options-Inner").slideToggle("fast")})),jQuery("#zp-ZotpressMetaBox-InText-Options h4 .toggle").click((function(e){jQuery(this).toggleClass("active"),jQuery(".toggle-button",jQuery(this)).toggleClass("dashicons-arrow-down-alt2 dashicons-arrow-up-alt2"),jQuery("#zp-ZotpressMetaBox-InText-Options-Inner").slideToggle("fast")})),jQuery("#zp-ZotpressMetaBox-InTextBib-Options h4 .toggle").click((function(e){jQuery(this).toggleClass("active"),jQuery(".toggle-button",jQuery(this)).toggleClass("dashicons-arrow-down-alt2 dashicons-arrow-up-alt2"),jQuery("#zp-ZotpressMetaBox-InTextBib-Options-Inner").slideToggle("fast")})),jQuery("#zp-ZotpressMetaBox-Biblio-Generate-Button").click((function(e){jQuery(this).parent().parent().parent().parent().hasClass("zp-ShortcodeBuilder")||(jQuery("#zp-ZotpressMetaBox-Biblio-Generate-Text").text(window.zpGenerateShortcodeString("bib")),jQuery("#zp-ZotpressMetaBox-Biblio-Generate-Inner").slideDown("fast"))})),jQuery("#zp-ZotpressMetaBox-InText-Generate-Button").click((function(e){jQuery(this).parent().parent().parent().parent().hasClass("zp-ShortcodeBuilder")||(jQuery("#zp-ZotpressMetaBox-InText-Generate-Text").text(window.zpGenerateShortcodeString("intext")),jQuery("#zp-ZotpressMetaBox-InText-Generate-Inner").slideDown("fast"))})),jQuery("#zp-ZotpressMetaBox-InTextBib-Generate-Button").click((function(e){jQuery(this).parent().parent().parent().parent().hasClass("zp-ShortcodeBuilder")||(jQuery("#zp-ZotpressMetaBox-InTextBib-Generate-Text").text(window.zpGenerateShortcodeString("intextbib")),jQuery("#zp-ZotpressMetaBox-InTextBib-Generate-Inner").slideDown("fast"))})),jQuery("#zp-ZotpressMetaBox-Biblio-Clear-Button").click((function(e){window.zpBiblio.author=!1,window.zpBiblio.year=!1,window.zpBiblio.style=!1,window.zpBiblio.sortby=!1,window.zpBiblio.sort=!1,window.zpBiblio.image=!1,window.zpBiblio.title=!1,window.zpBiblio.download=!1,window.zpBiblio.notes=!1,window.zpBiblio.zpabstract=!1,window.zpBiblio.cite=!1,window.zpBiblio.limit=!1,jQuery.each(window.zpRefItems,(function(e,t){window.zpRefItems.splice(e,1)})),jQuery("#zp-ZotpressMetaBox-Biblio-Options-Inner").slideUp("fast"),jQuery("#zp-ZotpressMetaBox-Biblio-Options h4 .toggle").removeClass("active"),jQuery("#zp-ZotpressMetaBox-Biblio-Generate-Inner").slideUp("fast"),jQuery("#zp-ZotpressMetaBox-Biblio-Options-Author").val(""),jQuery("#zp-ZotpressMetaBox-Biblio-Options-Year").val(""),jQuery("#zp-ZotpressMetaBox-Biblio-Options-Limit").val(""),jQuery("#zp-ZotpressMetaBox-Biblio-Options-Style option").removeAttr("checked"),jQuery("#zp-ZotpressMetaBox-Biblio-Options-Style").val(jQuery("#zp-ZotpressMetaBox-Biblio-Options-Style option[rel='default']").val()),jQuery("#zp-ZotpressMetaBox-Biblio-Options .zp-ZotpressMetaBox-Field-Radio input[type='radio']").prop("checked",!1),jQuery("div#zp-ZotpressMetaBox-List div.item").remove()})),jQuery("#zp-ZotpressMetaBox-InText-Clear-Button").click((function(e){window.zpInText.format=!1,window.zpInText.brackets=!1,window.zpInText.etal=!1,window.zpInText.and=!1,window.zpInText.separator=!1,jQuery.each(window.zpRefItems,(function(e,t){window.zpRefItems.splice(e,1)})),jQuery("#zp-ZotpressMetaBox-InText-Options-Inner").slideUp("fast"),jQuery("#zp-ZotpressMetaBox-InText-Options h4 .toggle").removeClass("active"),jQuery("#zp-ZotpressMetaBox-InText-Generate-Inner").slideUp("fast"),jQuery("#zp-ZotpressMetaBox-InText-Options-Format").val("(%a%, %d%, %p%)"),jQuery("#zp-ZotpressMetaBox-InText-Options-Brackets").val("default"),jQuery("#zp-ZotpressMetaBox-InText-Options-Etal").val("default"),jQuery("#zp-ZotpressMetaBox-InText-Options-And").val("default"),jQuery("#zp-ZotpressMetaBox-InText-Options-Separator").val("default"),jQuery("div#zp-ZotpressMetaBox-List div.item").remove()})),jQuery("#zp-ZotpressMetaBox-InTextBib-Clear-Button").click((function(e){window.zpInText.style=!1,window.zpInText.sortby=!1,window.zpInText.sort=!1,window.zpInText.image=!1,window.zpInText.title=!1,window.zpInText.download=!1,window.zpInText.zpabstract=!1,window.zpInText.notes=!1,window.zpInText.cite=!1,jQuery("#zp-ZotpressMetaBox-InTextBib-Options-Inner").slideUp("fast"),jQuery("#zp-ZotpressMetaBox-InTextBib-Options h4 .toggle").removeClass("active"),jQuery("#zp-ZotpressMetaBox-InTextBib-Generate-Inner").slideUp("fast"),jQuery("#zp-ZotpressMetaBox-InTextBib-Options-Style option").removeAttr("checked"),jQuery("#zp-ZotpressMetaBox-InTextBib-Options-Style").val(jQuery("#zp-ZotpressMetaBox-InTextBib-Options-Style option[rel='default']").val()),jQuery("#zp-ZotpressMetaBox-InTextBib-Options-SortBy option").removeAttr("checked"),jQuery("#zp-ZotpressMetaBox-InTextBib-Options-SortBy").val(jQuery("#zp-ZotpressMetaBox-InTextBib-Options-SortBy option[rel='default']").val()),jQuery("#zp-ZotpressMetaBox-InTextBib-Options .zp-ZotpressMetaBox-Field-Radio input[type='radio']").prop("checked",!1)})),window.zpGenerateShortcodeString=function(e="bib"){var t="";if("bib"==e){if(window.zpBiblio.author=jQuery.trim(jQuery("#zp-ZotpressMetaBox-Biblio-Options-Author").val()),window.zpBiblio.year=jQuery.trim(jQuery("#zp-ZotpressMetaBox-Biblio-Options-Year").val()),window.zpBiblio.style=jQuery.trim(jQuery("#zp-ZotpressMetaBox-Biblio-Options-Style").val()),window.zpBiblio.sortby=jQuery.trim(jQuery("#zp-ZotpressMetaBox-Biblio-Options-SortBy").val()),window.zpBiblio.limit=jQuery.trim(jQuery("#zp-ZotpressMetaBox-Biblio-Options-Limit").val()),!0===jQuery("input#zp-ZotpressMetaBox-Biblio-Options-Sort-ASC").is(":checked")&&(window.zpBiblio.sort="ASC"),!0===jQuery("input#zp-ZotpressMetaBox-Biblio-Options-Sort-DESC").is(":checked")&&(window.zpBiblio.sort="DESC"),!0===jQuery("input#zp-ZotpressMetaBox-Biblio-Options-Image-Yes").is(":checked")?window.zpBiblio.image="yes":window.zpBiblio.image="",!0===jQuery("input#zp-ZotpressMetaBox-Biblio-Options-Title-Yes").is(":checked")?window.zpBiblio.title="yes":window.zpBiblio.title="",!0===jQuery("input#zp-ZotpressMetaBox-Biblio-Options-Download-Yes").is(":checked")?window.zpBiblio.download="yes":window.zpBiblio.download="",!0===jQuery("input#zp-ZotpressMetaBox-Biblio-Options-Abstract-Yes").is(":checked")?window.zpBiblio.zpabstract="yes":window.zpBiblio.zpabstract="",!0===jQuery("input#zp-ZotpressMetaBox-Biblio-Options-Notes-Yes").is(":checked")?window.zpBiblio.notes="yes":window.zpBiblio.notes="",!0===jQuery("input#zp-ZotpressMetaBox-Biblio-Options-Cite-Yes").is(":checked")?window.zpBiblio.cite="yes":window.zpBiblio.cite="",t="[zotpress",window.zpRefItems.length>0){var i="";jQuery.each(window.zpRefItems,(function(e,t){"0"!=e&&(i+=","),i=i+"{"+t.api_user_id+":"+t.itemkey+"}"})),t+=' items="'+i+'"'}""!=window.zpBiblio.author&&(t+=' author="'+window.zpBiblio.author+'"'),""!=window.zpBiblio.year&&(t+=' year="'+window.zpBiblio.year+'"'),""!=window.zpBiblio.style&&(t+=' style="'+window.zpBiblio.style+'"'),""!=window.zpBiblio.sortby&&"default"!=window.zpBiblio.sortby&&(t+=' sortby="'+window.zpBiblio.sortby+'"'),""!=window.zpBiblio.sort&&(t+=' sort="'+window.zpBiblio.sort+'"'),""!=window.zpBiblio.image&&(t+=' showimage="'+window.zpBiblio.image+'"'),""!=window.zpBiblio.download&&(t+=' download="'+window.zpBiblio.download+'"'),""!=window.zpBiblio.zpabstract&&(t+=' abstract="'+window.zpBiblio.zpabstract+'"'),""!=window.zpBiblio.notes&&(t+=' notes="'+window.zpBiblio.notes+'"'),""!=window.zpBiblio.cite&&(t+=' cite="'+window.zpBiblio.cite+'"'),""!=window.zpBiblio.title&&(t+=' title="'+window.zpBiblio.title+'"'),""!=window.zpBiblio.limit&&(t+=' limit="'+window.zpBiblio.limit+'"'),t+="]"}else"intext"==e?(jQuery("#zp-ZotpressMetaBox-List .item").each((function(e,t){jQuery.trim(jQuery("input",t).val()).length>0&&jQuery.each(window.zpRefItems,(function(e,i){i.itemkey==jQuery(t).attr("rel")&&(i.pages=jQuery.trim(jQuery("input",t).val()))}))})),window.zpInText.format=jQuery.trim(jQuery("#zp-ZotpressMetaBox-InText-Options-Format").val()),window.zpInText.brackets=jQuery.trim(jQuery("#zp-ZotpressMetaBox-InText-Options-Brackets").val()),window.zpInText.etal=jQuery.trim(jQuery("#zp-ZotpressMetaBox-InText-Options-Etal").val()),window.zpInText.and=jQuery.trim(jQuery("#zp-ZotpressMetaBox-InText-Options-And").val()),window.zpInText.separator=jQuery.trim(jQuery("#zp-ZotpressMetaBox-InText-Options-Separator").val()),t="[zotpressInText",window.zpRefItems.length>0&&(t+=' item="',jQuery.each(window.zpRefItems,(function(e,i){t+="{"+i.api_user_id+":"+i.itemkey,!1!==i.pages&&(t+=","+i.pages),t+="},"})),t=t.substring(0,t.length-1)+'"'),""!=window.zpInText.format&&"(%a%, %d%, %p%)"!=window.zpInText.format&&(t+=' format="'+window.zpInText.format+'"'),""!=window.zpInText.brackets&&"default"!=window.zpInText.brackets&&(t+=' brackets="'+window.zpInText.brackets+'"'),""!=window.zpInText.etal&&"default"!=window.zpInText.etal&&(t+=' etal="'+window.zpInText.etal+'"'),""!=window.zpInText.and&&"default"!=window.zpInText.and&&(t+=' and="'+window.zpInText.and+'"'),""!=window.zpInText.separator&&"default"!=window.zpInText.separator&&(t+=' separator="'+window.zpInText.separator+'"'),t+="]"):"intextbib"==e&&(window.zpInTextBib.style=jQuery.trim(jQuery("#zp-ZotpressMetaBox-InTextBib-Options-Style").val()),window.zpInTextBib.sortby=jQuery.trim(jQuery("#zp-ZotpressMetaBox-InTextBib-Options-SortBy").val()),!0===jQuery("input#zp-ZotpressMetaBox-InTextBib-Options-Sort-ASC").is(":checked")&&(window.zpInTextBib.sort="ASC"),!0===jQuery("input#zp-ZotpressMetaBox-InTextBib-Options-Sort-DESC").is(":checked")&&(window.zpInTextBib.sort="DESC"),!0===jQuery("input#zp-ZotpressMetaBox-InTextBib-Options-Image-Yes").is(":checked")?window.zpInTextBib.image="yes":window.zpInTextBib.image="",!0===jQuery("input#zp-ZotpressMetaBox-InTextBib-Options-Title-Yes").is(":checked")?window.zpInTextBib.title="yes":window.zpInTextBib.title="",!0===jQuery("input#zp-ZotpressMetaBox-InTextBib-Options-Download-Yes").is(":checked")?window.zpInTextBib.download="yes":window.zpInTextBib.download="",!0===jQuery("input#zp-ZotpressMetaBox-InTextBib-Options-Abstract-Yes").is(":checked")?window.zpInTextBib.zpabstract="yes":window.zpInTextBib.zpabstract="",!0===jQuery("input#zp-ZotpressMetaBox-InTextBib-Options-Notes-Yes").is(":checked")?window.zpInTextBib.notes="yes":window.zpInTextBib.notes="",!0===jQuery("input#zp-ZotpressMetaBox-InTextBib-Options-Cite-Yes").is(":checked")?window.zpInTextBib.cite="yes":window.zpInTextBib.cite="",t="[zotpressInTextBib",""!=window.zpInTextBib.style&&(t+=' style="'+window.zpInTextBib.style+'"'),""!=window.zpInTextBib.sortby&&"default"!=window.zpInTextBib.sortby&&(t+=' sortby="'+window.zpInTextBib.sortby+'"'),""!=window.zpInTextBib.sort&&(t+=' sort="'+window.zpInTextBib.sort+'"'),""!=window.zpInTextBib.image&&(t+=' showimage="'+window.zpInTextBib.image+'"'),""!=window.zpInTextBib.title&&(t+=' title="'+window.zpInTextBib.title+'"'),""!=window.zpInTextBib.download&&(t+=' download="'+window.zpInTextBib.download+'"'),""!=window.zpInTextBib.zpabstract&&(t+=' abstract="'+window.zpInTextBib.zpabstract+'"'),""!=window.zpInTextBib.notes&&(t+=' notes="'+window.zpInTextBib.notes+'"'),""!=window.zpInTextBib.cite&&(t+=' cite="'+window.zpInTextBib.cite+'"'),t+="]");return t}}));